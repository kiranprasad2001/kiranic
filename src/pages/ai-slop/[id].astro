---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import aiNewsData from '../../data/ai-slop.json';
import { Bot, Terminal, Cpu, Sparkles, AlertTriangle, Cloud, Server, Database, Code, ArrowLeft } from 'lucide-react';
import { marked } from 'marked';

export async function getStaticPaths() {
    return aiNewsData.map(item => ({
        params: { id: item.id.toString() },
        props: { item },
    }));
}

const { item } = Astro.props;

// Icon mapping
const IconMap: Record<string, any> = {
    Bot, Terminal, Cpu, Sparkles, AlertTriangle, Cloud, Server, Database, Code
};

const Icon = IconMap[item.icon] || Bot;
const contentHtml = marked.parse(item.content || item.summary); // Fallback to summary if content missing
---

<BaseLayout title={`${item.headline} | AI Slop`} description={item.summary}>
    <Navbar />

    <main class="flex-grow min-h-screen bg-slate-50 dark:bg-slate-950 pt-24 pb-20">
        <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            
            {/* Navigation */}
            <a href="/ai-slop" class="inline-flex items-center text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-blue-400 transition-colors mb-8 group">
                <ArrowLeft class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform" />
                Back to the Slop
            </a>

            {/* Header */}
            <header class="mb-12">
                <div class="flex items-center gap-4 mb-6">
                    <div class="p-3 bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800">
                        <Icon class="w-8 h-8 text-purple-600 dark:text-purple-400" />
                    </div>
                    <span class="text-sm font-mono text-slate-500 dark:text-slate-400 uppercase tracking-widest bg-slate-200/50 dark:bg-slate-800/50 px-3 py-1 rounded-full">
                        {item.date}
                    </span>
                </div>

                <h1 class="text-3xl md:text-5xl font-bold text-slate-900 dark:text-white leading-tight mb-6">
                    {item.headline}
                </h1>

                <div class="flex flex-wrap gap-2">
                    {item.tags.map((tag: string) => (
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-100 dark:border-blue-800">
                            #{tag}
                        </span>
                    ))}
                </div>
            </header>

            {/* Content Body */}
            <div class="prose prose-lg prose-slate dark:prose-invert max-w-none">
                <div set:html={contentHtml} />
            </div>

            {/* Disclaimer */}
            <div class="mt-16 pt-8 border-t border-slate-200 dark:border-slate-800 text-center">
                <p class="text-sm text-slate-500 italic">
                    This content was hallucinated by an AI. Any resemblance to actual engineering disasters is purely a feature, not a bug.
                </p>
            </div>

        </article>
    </main>

    <Footer />
</BaseLayout>
